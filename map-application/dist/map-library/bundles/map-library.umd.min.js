!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("leaflet"),require("leaflet-control-geocoder")):"function"==typeof define&&define.amd?define("map-library",["exports","@angular/core","leaflet","leaflet-control-geocoder"],t):t((e=e||self)["map-library"]={},e.ng.core,e.leaflet)}(this,(function(e,t,i){"use strict";var n,a=function(){function e(){}return e.ɵfac=function(t){return new(t||e)},e.ɵprov=t.ɵɵdefineInjectable({token:e,factory:e.ɵfac,providedIn:"root"}),e}();(n=e.CONST||(e.CONST={}))[n.ZOOM_MAX=18]="ZOOM_MAX",n[n.ZOOM_MIN=2]="ZOOM_MIN",n[n.LAT_MAX=85]="LAT_MAX";var o=function(){function n(e){this.elem=e,this.mapLat=45,this.mapLng=5,this.mapZoom=5,this.onchange=new t.EventEmitter,this.onselect=new t.EventEmitter,this.searchInputFocused=!1,this.moveMode=!0,this.handleIcon="move",this.handleMenuIcon="zoom",this.displayMenu="",this.choiseMenu=1,this.navigate=!1,this.navigateId=0,this.mapMarkers=[]}return n.prototype.ngAfterViewInit=function(){var e=this;this.initMap(),this.initInput(),this.setMoveShift(),this.setSearch(this.search),this.setMarker(this.marker),setTimeout((function(){e.sendModifications("")}),2e3)},n.prototype.initMap=function(){this.map=i.map("map",{attributionControl:!1,zoomControl:!1,center:[this.mapLat,this.mapLng],zoom:this.mapZoom}),i.tileLayer("https://{s}.tile.osm.org/{z}/{x}/{y}.png").addTo(this.map),this.map.keyboard.disable(),this.geocoder=i.Control.geocoder({position:"topleft",collapsed:!1,placeholder:"Recherche...",defaultMarkGeocode:!0}).addTo(this.map)},n.prototype.setSearch=function(e){var t=this;this.search&&(this.geocoder.setQuery(e)._geocode(),setTimeout((function(){t.geocoder._results&&t.geocoder._results.length&&(t.geocoder._geocodeResultSelected(t.geocoder._results[0]),t.geocoder._clearResults())}),2e3))},n.prototype.setMarker=function(e){var t=this;this.cleanMarkers();var n=0;e.forEach((function(e){"lat"in e&&"lng"in e&&(e.id=n,e.text?t.mapMarkers[n]=t.generateIconMarker(e):t.mapMarkers[n]=i.marker([e.lat,e.lng]),t.mapMarkers[n].addTo(t.map),n++)}))},n.prototype.cleanMarkers=function(){for(var e=0;e<this.mapMarkers.length;e++)this.map.removeLayer(this.mapMarkers[e])},n.prototype.generateIconMarker=function(e){var t='<div id="marker_'+e.id+'" style="background: white; border-radius:20px; position:absolute; padding:5px 10px 0 10px; text-align:center;">\n              <div style="text-align:center; font-size:1.2em;">'+e.text+"</div>\n              "+(e.content?"<span>"+e.content+"</span>":"")+(e.img?'<img style="width:60px" src="'+e.img+'"/>':"")+"\n            </div>";return new i.Marker([e.lat,e.lng],{icon:new i.DivIcon({className:"",iconSize:[100,70],iconAnchor:[45,e.img?40:10],html:t})})},n.prototype.ngOnChanges=function(e){if(this.map)switch(Object.keys(e)[0]){case"mapZoom":case"mapLat":case"mapLng":this.map.setView([this.mapLat,this.mapLng],this.mapZoom),this.setMoveShift();break;case"marker":this.setMarker(this.marker);break;case"search":this.setSearch(this.search)}},n.prototype.keyEvent=function(e){""!=this.displayMenu?this.handlingMenu(e.key):this.navigate?this.handlingNavigation(e.key):(this.handlingMap(e.key),this.sendModifications(e.key))},n.prototype.handlingNavigation=function(e){switch(e){case"ArrowUp":this.navigateMarker(1,0);break;case"ArrowDown":this.navigateMarker(-1,0);break;case"ArrowRight":this.navigateMarker(0,1);break;case"ArrowLeft":this.navigateMarker(0,-1);break;case"Enter":this.marker[this.navigateId]&&this.sendSelectEvent(this.marker[this.navigateId]);break;case"Escape":this.openMenu()}},n.prototype.handlingMenu=function(e){switch(e){case"ArrowRight":this.choiseMenu++,this.choiseMenu>3&&(this.choiseMenu=0);break;case"ArrowLeft":this.choiseMenu--,this.choiseMenu<0&&(this.choiseMenu=3);break;case"Enter":this.navigate=!1,0==this.choiseMenu?this.setFocus():this.setFocusOut(),1==this.choiseMenu?(this.setMarker(this.marker),this.changeMode()):2==this.choiseMenu?this.setNavigationMode():3==this.choiseMenu&&alert("exit"),this.closeMenu();break;case"Escape":this.closeMenu()}},n.prototype.handlingMap=function(t){switch(t){case"ArrowUp":this.moveMode?this.map.getCenter().lat<e.CONST.LAT_MAX&&this.moveMap(1,0):this.mapZoom<e.CONST.ZOOM_MAX&&(this.zoomMap(1),this.moveShift/=2);break;case"ArrowDown":this.moveMode?this.map.getCenter().lat>-e.CONST.LAT_MAX&&this.moveMap(-1,0):this.mapZoom>e.CONST.ZOOM_MIN&&(this.zoomMap(-1),this.moveShift*=2);break;case"ArrowRight":this.moveMode&&this.moveMap(0,1);break;case"ArrowLeft":this.moveMode&&this.moveMap(0,-1);break;case"Enter":this.changeMode();break;case"Escape":this.openMenu()}},n.prototype.changeMode=function(){this.moveMode=!this.moveMode,this.moveMode?(this.handleIcon="move",this.handleMenuIcon="zoom"):(this.handleIcon="zoom",this.handleMenuIcon="move")},n.prototype.sendModifications=function(e){var t=this.map.getSize(),i=this.map.project([this.mapLat,this.mapLng],this.mapZoom),n=this.map.unproject([i.x-t.x/2,i.y-t.y/2],this.mapZoom),a=this.map.unproject([i.x+t.x/2,i.y+t.y/2],this.mapZoom);this.onchange.emit({key:e,zoom:this.mapZoom,lat:this.mapLat,lng:this.mapLng,view:{top:n.lat,left:n.lng,bottom:a.lat,right:a.lng}})},n.prototype.sendSelectEvent=function(e){this.onselect.emit(e)},n.prototype.openMenu=function(){this.displayMenu="show-menu"},n.prototype.closeMenu=function(){this.displayMenu="",this.choiseMenu=1},n.prototype.selectMenu=function(e){"Escape"==e&&this.closeMenu()},n.prototype.setNavigationMode=function(){this.navigate=!0,this.handleIcon="navigation",this.navigateMarker(0,0),this.moveMode=!1,this.handleMenuIcon="move"},n.prototype.navigateMarker=function(e,t){if(this.marker.length){if(1==this.marker.length)return this.navigateId=0,void(this.elem.nativeElement.querySelector("#marker_"+this.navigateId).style.background="orange");this.navigateId>this.marker.length&&(this.navigateId=0),0==e&&0==t||(this.elem.nativeElement.querySelector("#marker_"+this.marker[this.navigateId].id).style.background="white"),t>0?this.findFirstRightElement():t<0?this.findFirstLeftElement():e>0?this.findFirstTopElement():e<0?this.findFirstBottomElement():this.navigateId=0,this.elem.nativeElement.querySelector("#marker_"+this.navigateId).style.background="orange"}},n.prototype.findFirstLeftElement=function(){var e=this.marker[this.navigateId],t=this.marker[0==this.navigateId?1:0];if(this.marker.forEach((function(i){i!=e&&i.lng<e.lng&&(i.lng>t.lng||t.lng>e.lng)&&(t=i)})),t.lng>=e.lng){var i=this.marker[0];this.marker.forEach((function(e){e.lng>i.lng&&(i=e)})),this.navigateId=i.id}else this.navigateId=t.id},n.prototype.findFirstRightElement=function(){var e=this.marker[this.navigateId],t=this.marker[0==this.navigateId?1:0];if(this.marker.forEach((function(i){i!=e&&i.lng>e.lng&&(i.lng<t.lng||t.lng<e.lng)&&(t=i)})),t.lng<=e.lng){var i=this.marker[0];this.marker.forEach((function(e){e.lng<i.lng&&(i=e)})),this.navigateId=i.id}else this.navigateId=t.id},n.prototype.findFirstBottomElement=function(){var e=this.marker[this.navigateId],t=this.marker[0==this.navigateId?1:0];if(this.marker.forEach((function(i){i!=e&&i.lat<e.lat&&(i.lat>t.lat||t.lat>e.lat)&&(t=i)})),t.lat>=e.lat){var i=this.marker[0];this.marker.forEach((function(e){e.lat>i.lat&&(i=e)})),this.navigateId=i.id}else this.navigateId=t.id},n.prototype.findFirstTopElement=function(){var e=this.marker[this.navigateId],t=this.marker[0==this.navigateId?1:0];if(this.marker.forEach((function(i){i!=e&&i.lat>e.lat&&(i.lat<t.lat||t.lat<e.lat)&&(t=i)})),t.lat<=e.lat){var i=this.marker[0];this.marker.forEach((function(e){e.lat<i.lat&&(i=e)})),this.navigateId=i.id}else this.navigateId=t.id},n.prototype.setPosition=function(){var e=this.map.getCenter();this.mapLat=e.lat,this.mapLng=e.lng,this.mapZoom=this.map.getZoom(),this.setMoveShift()},n.prototype.moveMap=function(e,t){this.mapLat+=e*this.moveShift,this.mapLng+=t*this.moveShift,this.map.setView([this.mapLat,this.mapLng],this.mapZoom)},n.prototype.zoomMap=function(e){this.mapZoom+=e,this.map.setZoom(this.mapZoom)},n.prototype.setMoveShift=function(){this.moveShift=80;for(var e=1;e<this.mapZoom;e++)this.moveShift/=2},n.prototype.initInput=function(){this.searchInput=this.elem.nativeElement.querySelector(".leaflet-control-geocoder-form input"),this.searchBar=this.elem.nativeElement.querySelector(".leaflet-bar"),this.setFocusOut()},n.prototype.setFocus=function(){this.searchBar.style.display="block",this.searchInput.focus(),this.searchInputFocused=!0},n.prototype.setFocusOut=function(){this.searchInput.blur(),this.searchBar.style.display="none",this.searchInputFocused=!1,this.setPosition()},n.ɵfac=function(e){return new(e||n)(t.ɵɵdirectiveInject(t.ElementRef))},n.ɵcmp=t.ɵɵdefineComponent({type:n,selectors:[["map-library"]],hostBindings:function(e,i){1&e&&t.ɵɵlistener("keyup",(function(e){return i.keyEvent(e)}),!1,t.ɵɵresolveWindow)},inputs:{mapLat:"mapLat",mapLng:"mapLng",mapZoom:"mapZoom",search:"search",marker:"marker"},outputs:{onchange:"onchange",onselect:"onselect"},features:[t.ɵɵNgOnChangesFeature],decls:9,vars:19,consts:[[1,"map-container"],["id","map"],[1,"menu-container"],[1,"menu-box"]],template:function(e,i){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵelement(1,"i"),t.ɵɵelement(2,"div",1),t.ɵɵelementEnd(),t.ɵɵelementStart(3,"div",2),t.ɵɵelementStart(4,"div",3),t.ɵɵelement(5,"i"),t.ɵɵelement(6,"i"),t.ɵɵelement(7,"i"),t.ɵɵelement(8,"i"),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵclassMapInterpolate1("icon ",i.handleIcon,""),t.ɵɵadvance(2),t.ɵɵclassMap(i.displayMenu),t.ɵɵadvance(2),t.ɵɵclassMapInterpolate1("icon search ",0==i.choiseMenu?"selected":"",""),t.ɵɵadvance(1),t.ɵɵclassMapInterpolate2("icon ",i.handleMenuIcon," ",1==i.choiseMenu?"selected":"",""),t.ɵɵadvance(1),t.ɵɵclassMapInterpolate1("icon navigation ",2==i.choiseMenu?"selected":"",""),t.ɵɵadvance(1),t.ɵɵclassMapInterpolate1("icon logout ",3==i.choiseMenu?"selected":"",""))},styles:[".map-container[_ngcontent-%COMP%]{position:absolute;z-index:1;top:0;left:0;right:0;bottom:0}#map[_ngcontent-%COMP%]{width:100%;height:100%}.map-container[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{position:absolute;z-index:1000;top:10px;right:10px;width:50px;height:50px}.menu-container[_ngcontent-%COMP%]{position:absolute;z-index:1001;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3);display:none}.menu-box[_ngcontent-%COMP%]{position:absolute;top:calc(50% - 100px);left:calc(50% - 300px);width:600px;height:150px;background-color:#fff;border:1px solid orange!important;text-align:center;margin-top:50px}.menu-box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:inline-block;width:150px;height:150px;border:0;border-radius:3px;background-size:100px 100px;background-repeat:no-repeat;background-position:center}.menu-box[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{background-color:orange}.show-menu[_ngcontent-%COMP%]{display:block}"]}),n}(),s=function(){function e(){}return e.ɵmod=t.ɵɵdefineNgModule({type:e}),e.ɵinj=t.ɵɵdefineInjector({factory:function(t){return new(t||e)},imports:[[]]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(s,{declarations:[o],exports:[o]}),e.MapLibraryComponent=o,e.MapLibraryModule=s,e.MapLibraryService=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=map-library.umd.min.js.map